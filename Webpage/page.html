<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SageMaker Endpoint Interaction</title>
    <link rel="stylesheet" href="style.css">
    <script type="module">
        document.addEventListener("DOMContentLoaded", async function () {
            const container = document.getElementById("champion-grid");
            const droppableBoxes = document.querySelectorAll(".box.dropeable");
    
            try {
                const response = await fetch("assets/champions_ids.json");
                const champions = await response.json();
    
                let html = "<table style='margin: auto;'><tbody>";
                let count = 0;
    
                Object.keys(champions).forEach(champion => {
                    if (count % 6 === 0) html += "<tr>";
    
                    const imgElement = `<td style='text-align: center; padding: 15px;'>
                        <div style="display: flex; align-items: center; justify-content: center; width: 7rem; height: 7rem; background-image: url('assets/champion_images/${champion}.png');
                        background-size: cover; background-position: center; border-radius: 10px; cursor: grab; margin: auto;"
                        draggable='true' data-champion='${champion}'></div>
                        <span style='display: block; font-size: 14px; font-weight: bold; color: black; margin-top: 5px;'>${champion}</span>
                    </td>`;
    
                    html += imgElement;
                    count++;
    
                    if (count % 6 === 0) html += "</tr>";
                });
    
                if (count % 6 !== 0) html += "</tr>";
                html += "</tbody></table>";
    
                container.innerHTML = html;
    
                document.querySelectorAll("[draggable='true']").forEach(imgElement => {
                    imgElement.addEventListener("dragstart", function (event) {
                        event.dataTransfer.setData("text", imgElement.dataset.champion);
                    });
                });
    
                droppableBoxes.forEach(box => {
                    box.addEventListener("dragover", function (event) {
                        event.preventDefault();
                    });
    
                    box.addEventListener("drop", function (event) {
                        event.preventDefault();
                        const newChampion = event.dataTransfer.getData("text");
    
                        if (newChampion) {
                            const previousChampion = box.getAttribute("champion");
    
                            if (previousChampion) {
                                const previousChampionElement = document.querySelector(`[data-champion='${previousChampion}']`);
                                if (previousChampionElement) {
                                    previousChampionElement.setAttribute("draggable", "true");
                                    previousChampionElement.style.cursor = "grab";
                                    previousChampionElement.style.opacity = "1";
                                }
                            }
    
                            box.style.backgroundImage = `url('assets/champion_images/${newChampion}.png')`;
                            box.setAttribute("champion", newChampion);
    
                            const newChampionElement = document.querySelector(`[data-champion='${newChampion}']`);
                            if (newChampionElement) {
                                newChampionElement.setAttribute("draggable", "false");
                                newChampionElement.style.cursor = "not-allowed";
                                newChampionElement.style.opacity = "0.5"; 
                            }
                            if (!box.querySelector(".remove-button")) {
                                const removeBtn = document.createElement("img");
                                removeBtn.src = "assets/imgs/remove.png";
                                removeBtn.classList.add("remove-button");
                                removeBtn.style.position = "absolute";
                                removeBtn.style.top = "5px";
                                removeBtn.style.right = "5px";
                                removeBtn.style.width = "25px";
                                removeBtn.style.height = "25px";
                                removeBtn.style.cursor = "pointer";
                                removeBtn.style.borderRadius = "50%";
                                removeBtn.style.padding = "3px";
    
                                removeBtn.addEventListener("click", function () {
                                    box.removeAttribute("champion");
                                    box.style.backgroundImage = "url(assets/champion_images/-1.png)";
                                    removeBtn.remove();
    
                                    if (newChampionElement) {
                                        newChampionElement.setAttribute("draggable", "true");
                                        newChampionElement.style.cursor = "grab";
                                        newChampionElement.style.opacity = "1";
                                    }
                                });
    
                                box.style.position = "relative";
                                box.appendChild(removeBtn);
                            }
                        }
                    });
                });
    
            } catch (error) {
                console.error("Error loading champions JSON:", error);
            }
        });

        document.addEventListener("DOMContentLoaded", async () => {
            let playerNames = [];
            let playerNamesLower = [];
            try {
                const response = await fetch("assets/players_ids.json");
                const data = await response.json();
                playerNamesLower = Object.keys(data).map(name => name.toLowerCase());
                playerNames = Object.keys(data)
            } catch (error) {
                console.error("Error loading player data:", error);
            }

            const inputs = document.querySelectorAll(".box-label");

            inputs.forEach((input, index) => {
                input.setAttribute("autocomplete", "off");

                const dataList = document.createElement("datalist");
                dataList.id = `datalist-${input.dataset.slot}`;
                document.body.appendChild(dataList);
                input.setAttribute("list", dataList.id);

                input.addEventListener("focus", () => updateDatalist(dataList, input.value));
                input.addEventListener("input", () => updateDatalist(dataList, input.value));

                input.addEventListener("change", function () {
                    if (!playerNamesLower.includes(this.value.toLowerCase())) {
                        alert("Invalid player name! Please select from the list.");
                        this.value = "";
                    } else {
                        moveToNextInput(index);
                    }
                });

                input.addEventListener("keydown", function (event) {
                    if (event.key === "Enter") {
                        event.preventDefault();
                        moveToNextInput(index);
                    }
                });
            });

            function updateDatalist(dataList, inputValue) {
                dataList.innerHTML = "";
                
                const filteredNames = playerNames.filter(name => name.toLowerCase().includes(inputValue.toLowerCase()));
                
                filteredNames.slice(0, 4).forEach(name => {
                    const option = document.createElement("option");
                    option.value = name;
                    dataList.appendChild(option);
                });
            }

            function moveToNextInput(index) {
                const nextInput = inputs[index + 1];
                if (nextInput) {
                    nextInput.focus();
                }
            }
        });


    </script>
    

</head>
<body>
    <div class="stacked-boxes-container">
        <div class="stacked-box">
            <input type="text" class="box-label" data-slot="1" placeholder="Blue Top">
            <div class="box dropeable" style="background-image: url('assets/champion_images/-1.png');" data-slot="1"></div>
        </div>
        <div class="stacked-box">
            <input type="text" class="box-label" data-slot="2" placeholder="Blue Jungle">
            <div class="box dropeable" style="background-image: url('assets/champion_images/-1.png');" data-slot="2"></div>
        </div>
        <div class="stacked-box">
            <input type="text" class="box-label" data-slot="3" placeholder="Blue Mid">
            <div class="box dropeable" style="background-image: url('assets/champion_images/-1.png');" data-slot="3"></div>
        </div>
        <div class="stacked-box">
            <input type="text" class="box-label" data-slot="4" placeholder="Blue ADC">
            <div class="box dropeable" style="background-image: url('assets/champion_images/-1.png');" data-slot="4"></div>
        </div>
        <div class="stacked-box">
            <input type="text" class="box-label" data-slot="5" placeholder="Blue Support">
            <div class="box dropeable" style="background-image: url('assets/champion_images/-1.png');" data-slot="5"></div>
        </div>
    </div>
    
    <div class="scrollable-table" id="champion-grid"></div>
    
    <div class="stacked-boxes-container">
        <div class="stacked-box">
            <div class="box dropeable" style="background-image: url('assets/champion_images/-1.png');" data-slot="6"></div>
            <input type="text" class="box-label" data-slot="6" placeholder="Red Top">
        </div>
        <div class="stacked-box">
            <div class="box dropeable" style="background-image: url('assets/champion_images/-1.png');" data-slot="7"></div>
            <input type="text" class="box-label" data-slot="7" placeholder="Red Jungle">
        </div>
        <div class="stacked-box">
            <div class="box dropeable" style="background-image: url('assets/champion_images/-1.png');" data-slot="8"></div>
            <input type="text" class="box-label" data-slot="8" placeholder="Red Mid">
        </div>
        <div class="stacked-box">
            <div class="box dropeable" style="background-image: url('assets/champion_images/-1.png');" data-slot="9"></div>
            <input type="text" class="box-label" data-slot="9" placeholder="Red ADC">
        </div>
        <div class="stacked-box">
            <div class="box dropeable" style="background-image: url('assets/champion_images/-1.png');" data-slot="10"></div>
            <input type="text" class="box-label" data-slot="10" placeholder="Red Support">
        </div>
    </div>
    
    
    <!-- <h1>SageMaker Endpoint Interaction</h1>
    <form id="endpointForm">
        <label for="players1">Players 1 (comma-separated):</label>
        <input type="text" id="players1" name="players1" required>

        <label for="players2">Players 2 (comma-separated):</label>
        <input type="text" id="players2" name="players2" required>

        <label for="champions1">Champions 1 (comma-separated):</label>
        <input type="text" id="champions1" name="champions1" required>

        <label for="champions2">Champions 2 (comma-separated):</label>
        <input type="text" id="champions2" name="champions2" required>

        <input type="submit" value="Submit">
    </form>

    <p id="result"></p>

    <script>
        import { API_URL } from "./config.js";
        document.getElementById('endpointForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const players1 = document.getElementById('players1').value.split(',').map(item => item.trim());
            const players2 = document.getElementById('players2').value.split(',').map(item => item.trim());
            const champions1 = document.getElementById('champions1').value.split(',').map(item => item.trim());
            const champions2 = document.getElementById('champions2').value.split(',').map(item => item.trim());

            // Adjust the URL to point to your SageMaker endpoint

            // Create the request payload
            const payload = JSON.stringify({
                players1: players1,
                players2: players2,
                champions1: champions1,
                champions2: champions2
            });

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: payload
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                const result = await response.json();
                document.getElementById('result').innerText = JSON.stringify(result, null, 2);
            } catch (error) {
                document.getElementById('result').innerText = `Error: ${error.message}`;
            }
        });
    </script>
-->
    
</body>
</html>
